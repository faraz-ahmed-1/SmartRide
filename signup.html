<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Account</title>
<link rel="shortcut icon" href="SmartRide.png" type="image/x-icon">
<style>
:root {
    --primary: #4285f4;
    --primary-dark: #3367d6;
    --secondary: #34a853;
    --error: #ea4335;
    --text: #202124;
    --text-light: #5f6368;
    --border: #dadce0;
    --bg: #f8f9fa;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
}

body {
    background-color: var(--bg);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background-image: radial-gradient(circle at top right, rgba(66, 133, 244, 0.1) 0%, transparent 50%);
}

.login-container {
    width: 100%;
    max-width: 420px;
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    padding: 40px 30px;
    margin: 20px;
}

.logo {
    text-align: center;
    margin-bottom: 35px;
}

.logo h1 {
    color: var(--primary);
    font-size: 28px;
    font-weight: 600;
    letter-spacing: -0.5px;
}

.logo p {
    color: var(--text-light);
    font-size: 14px;
    margin-top: 6px;
}

.input-group {
    margin-bottom: 18px;
    position: relative;
}

.input-group label {
    display: block;
    margin-bottom: 6px;
    color: var(--text);
    font-size: 14px;
    font-weight: 500;
}

.input-group input,
.input-group select {
    width: 100%;
    padding: 14px;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 16px;
    transition: all 0.3s;
}

.input-group input:focus,
.input-group select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(66,133,244,0.15);
}

.password-toggle {
    position: absolute;
    right: 12px;
    top: 40px;
    cursor: pointer;
    color: var(--text-light);
    font-size: 14px;
}

.error-message {
    color: var(--error);
    font-size: 13px;
    margin-top: 4px;
    display: none;
}

input.error,
select.error {
    border-color: var(--error);
}

button {
    width: 100%;
    padding: 14px;
    background-color: var(--secondary);
    color: #fff;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.2s;
}

button:hover {
    transform: translateY(-2px);
}

.divider {
    display: flex;
    align-items: center;
    margin: 24px 0;
    color: var(--text-light);
    font-size: 14px;
}

.divider::before,
.divider::after {
    content: "";
    flex: 1;
    border-bottom: 1px solid var(--border);
}

.divider::before {
    margin-right: 16px;
}

.divider::after {
    margin-left: 16px;
}

.signup-link {
    text-align: center;
    font-size: 14px;
    color: var(--text-light);
}

.signup-link a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
}

.signup-link a:hover {
    text-decoration: underline;
}
/* MODAL */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:999;
}

.modal-content{
  background:#fff;
  width:100%;
  max-width:380px;
  padding:30px;
  border-radius:10px;
  position:relative;
}

.modal h2{
  text-align:center;
  margin-bottom:20px;
}

.modal button{
  margin-top:15px;
  width:100%;
  padding:12px;
  background:#34a853;
  color:#fff;
  border:none;
  border-radius:6px;
  font-size:16px;
}

@media (max-width: 768px) {
    body {
        padding: 10px;
        align-items: flex-start;
    }

    .login-container {
        padding: 25px;
        margin: 0 auto;
        width: 100%;
        max-width: 100%;
        border-radius: 8px;
        box-shadow: none;
    }

    .logo h1 {
        font-size: 22px;
    }

    .logo p {
        font-size: 12px;
    }

    .input-group label {
        font-size: 13px;
    }

    .input-group input,
    .input-group select {
        padding: 12px;
        font-size: 14px;
    }

    .password-toggle {
        font-size: 12px;
        top: 35px;
        right: 10px;
    }

    button {
        padding: 12px;
        font-size: 15px;
    }
}

@media (max-width: 480px) {
    .login-container {
        padding: 20px;
    }

    .logo h1 {
        font-size: 20px;
    }

    button, input, select {
        padding: 10px;
        font-size: 14px;
    }

    .divider {
        font-size: 12px;
    }
}
</style>
</head>
<body>
<div class="login-container">
    <div class="logo">
        <h1>Register</h1>
        <p>Start your journey with us</p>
    </div>

    <form id="loginForm">
        <div class="input-group">
            <label for="name">Full Name</label>
            <input type="text" id="name" placeholder="Enter your full name" required>
            <div class="error-message" id="name-error">Please enter your name</div>
        </div>

        <div class="input-group">
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="Enter your email" required>
            <div class="error-message" id="email-error">Please enter a valid email</div>
            <div class="error-message" id="email-exist">Email already exists</div>
        </div>

        <div class="input-group">
            <label for="Phone">Phone</label>
            <input type="text" id="Phone" placeholder="Contact" required>
            <div class="error-message" id="phone-error">Phone number must be at least 11 digits</div>
        </div>

        <div class="input-group">
            <label for="gender">Gender</label>
            <select id="gender" required>
                <option value="" disabled selected>Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
            </select>
            <div class="error-message" id="gender-error">Please select a gender</div>
        </div>

        <div class="input-group">
            <label for="role">Role</label>
            <select id="role" required>
                <option value="" disabled selected>Select Role</option>
                <option value="Passenger">Passenger</option>
                <option value="Driver">Driver</option>
            </select>
            <div class="error-message" id="role-error">Please select a role</div>
        </div>

        <div class="input-group" id="vehicle-group" style="display:none;">
            <label for="vehicleNumber">Vehicle Registration Number</label>
            <input type="text" id="vehicleNumber" placeholder="e.g. ABC-1234" disabled>
        <div class="error-message" id="vehicle-error">
            Vehicle registration number is required for drivers
        </div>
</div>

        <button type="submit">Create Account</button>
    </form>

    <div class="divider">OR</div>

    <div class="signup-link">
        Already have an account? <a href="index.html">Log in</a>
    </div>
</div>

<!-- PASSWORD MODAL -->
<div id="passwordModal" class="modal">
  <div class="modal-content">
    <h2>Create Password</h2>

    <div class="input-group">
      <label>Password</label>
      <input type="password" id="password">
      <span class="password-toggle" onclick="togglePass('password')">Show</span>
      <div class="error-message" id="password-error">
        Password must be at least 8 characters
      </div>
    </div>

    <div class="input-group">
      <label>Confirm Password</label>
      <input type="password" id="confirm-password">
      <span class="password-toggle" onclick="togglePass('confirm-password')">Show</span>
      <div class="error-message" id="confirm-password-error">
        Passwords must match
      </div>
    </div>

    <button onclick="savePassword()">Save Password</button>
  </div>
</div>

<script>
/* ---------------- VEHICLE FIELD LOGIC ---------------- */
const vehicleGroup = document.getElementById("vehicle-group");
const vehicleInput = document.getElementById("vehicleNumber");
const vehicleError = document.getElementById("vehicle-error");

/* ---------------- FORM ELEMENTS ---------------- */
const form = document.getElementById("loginForm");
const nameInput = document.getElementById("name");
const emailInput = document.getElementById("email");
const phoneInput = document.getElementById("Phone");
const genderInput = document.getElementById("gender");
const roleInput = document.getElementById("role");

/* ---------------- ERROR ELEMENTS ---------------- */
const nameError = document.getElementById("name-error");
const emailError = document.getElementById("email-error");
const emailExistError = document.getElementById("email-exist");
const phoneError = document.getElementById("phone-error");
const genderError = document.getElementById("gender-error");
const roleError = document.getElementById("role-error");

/* ---------------- PASSWORD MODAL ---------------- */
const passwordModal = document.getElementById("passwordModal");
const passwordInput = document.getElementById("password");
const confirmPasswordInput = document.getElementById("confirm-password");

let createdUserId = null;

/* ---------------- API ENDPOINTS ---------------- */
const SIGNUP_API = "http://localhost:3000/api/signup";
const PASSWORD_API = "http://localhost:3000/api/password";

/* ---------------- ROLE CHANGE ---------------- */
roleInput.addEventListener("change", () => {
  if (roleInput.value === "Driver") {
    vehicleGroup.style.display = "block";
    vehicleInput.disabled = false;
  } else {
    vehicleGroup.style.display = "none";
    vehicleInput.disabled = true;
    vehicleInput.value = "";
    vehicleError.style.display = "none";
    vehicleInput.classList.remove("error");
  }
});

/* ---------------- SIGNUP SUBMIT ---------------- */
form.addEventListener("submit", async (e) => {
  e.preventDefault();
  let isValid = true;

  // Vehicle validation
  if (roleInput.value === "Driver" && vehicleInput.value.trim() === "") {
    vehicleInput.classList.add("error");
    vehicleError.style.display = "block";
    isValid = false;
  } else {
    vehicleInput.classList.remove("error");
    vehicleError.style.display = "none";
  }

  // Name
  if (nameInput.value.trim() === "") {
    nameInput.classList.add("error");
    nameError.style.display = "block";
    isValid = false;
  } else {
    nameInput.classList.remove("error");
    nameError.style.display = "none";
  }

  // Email
  if (!emailInput.value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
    emailInput.classList.add("error");
    emailError.style.display = "block";
    isValid = false;
  } else {
    emailInput.classList.remove("error");
    emailError.style.display = "none";
  }

  // Phone
  if (phoneInput.value.length < 11) {
    phoneInput.classList.add("error");
    phoneError.style.display = "block";
    isValid = false;
  } else {
    phoneInput.classList.remove("error");
    phoneError.style.display = "none";
  }

  // Gender
  if (!genderInput.value) {
    genderInput.classList.add("error");
    genderError.style.display = "block";
    isValid = false;
  } else {
    genderInput.classList.remove("error");
    genderError.style.display = "none";
  }

  // Role
  if (!roleInput.value) {
    roleInput.classList.add("error");
    roleError.style.display = "block";
    isValid = false;
  } else {
    roleInput.classList.remove("error");
    roleError.style.display = "none";
  }

  if (!isValid) return;

  try {
    const res = await fetch(SIGNUP_API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name: nameInput.value,
        email: emailInput.value,
        contact: phoneInput.value,
        gender: genderInput.value,
        role: roleInput.value,
        vehicleNumber: roleInput.value === "Driver" ? vehicleInput.value : null
      })
    });

    const data = await res.json();

    if (data.error) {
      alert(data.error);
      return;
    }

    // âœ… Save userId & open password popup
    createdUserId = data.userId;
    passwordModal.style.display = "flex";

  } catch (err) {
    console.error(err);
    alert("Signup failed");
  }
});

/* ---------------- PASSWORD FUNCTIONS ---------------- */
function togglePass(id) {
  const input = document.getElementById(id);
  input.type = input.type === "password" ? "text" : "password";
}

async function savePassword() {
  const pass = passwordInput.value;
  const confirm = confirmPasswordInput.value;

  if (pass.length < 8) {
    document.getElementById("password-error").style.display = "block";
    return;
  }

  if (pass !== confirm) {
    document.getElementById("confirm-password-error").style.display = "block";
    return;
  }

  const res = await fetch(PASSWORD_API, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      userId: createdUserId,
      password: pass
    })
  });

  const data = await res.json();

  if (data.success) {
    alert("Account created successfully!");
    passwordModal.style.display = "none";
    form.reset();
  } else {
    alert("Failed to save password");
  }
}
</script>

</body>
</html>
